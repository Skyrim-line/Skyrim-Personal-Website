# 📷 PhotoGallery 滚动组件性能问题分析与优化总结

## 🧩 原始实现的问题

该 `PhotoGallery.tsx` 页面最初实现方式基于：

- `requestAnimationFrame` 实现平滑横向滚动动画
- `photoData` 三倍展开（3x 渲染）模拟无缝循环
- 每个图像绑定 `Popover` 组件用于显示信息卡片
- 鼠标 `hover` 后暂停滚动，离开后恢复

### ❌ 存在的主要性能问题：

| 问题点                            | 描述                                                             |
| --------------------------------- | ---------------------------------------------------------------- |
| 🔁 requestAnimationFrame 持续运行 | 每帧更新 DOM `transform` 导致 CPU 占用高、主线程阻塞             |
| 🏗 过多 DOM 节点                   | 使用 `photoData * 3` 三倍图像渲染，初始加载时 DOM 极为庞大       |
| 📦 Popover 内容预挂载             | 所有 `PopoverContent` 都提前加载，阻塞渲染，增加初始内存占用     |
| 📷 LCP 图像未优化加载             | 未区分首屏图像和延迟加载图像，影响 Largest Contentful Paint 指标 |
| 🖱 hover 暂停逻辑不完整            | 离开 `PopoverContent` 后无法正确恢复动画，造成逻辑卡死           |
| 📱 移动端适配缺失                 | 无点击行为支持，hover 在触屏设备无效，交互逻辑不可用             |

---

## ✅ 优化目标与方案

### 💡 优化目标：

- 提升 LCP（Largest Contentful Paint）性能，< 1.5s
- 减少主线程占用和帧动画计算
- 改善 DOM 复杂度与图片加载体验
- 兼容移动端滑动、点击操作

### 🛠 具体优化方案：

| 优化点                | 实现方式                                           |
| --------------------- | -------------------------------------------------- |
| ✅ 替代帧动画         | 使用 CSS `scroll-snap` 实现横向滚动                |
| ✅ 限制图像数量       | 改为 `photoData.slice(0, 12)` 控制初始渲染数量     |
| ✅ 弹窗懒加载         | 使用 `Dialog` 弹窗，点击后再加载内容，减轻初始压力 |
| ✅ 懒加载图像         | 除首图外均使用 `<img loading="lazy">` 延迟加载     |
| ✅ 首图 preload       | 可通过 `<link rel="preload" as="image">` 提前加载  |
| ✅ 移动端支持点击行为 | 替代 hover 行为为 click 打开弹窗                   |
| ✅ 简化 DOM 层级      | 不再嵌套复杂组件结构，弹窗只显示一次完整卡片       |

---

## 🎯 优化结果预期（以 Lighthouse 检测为准）

| 指标                | 优化前        | 优化后               |
| ------------------- | ------------- | -------------------- |
| LCP                 | ❌ >3s        | ✅ <1.5s             |
| Total Blocking Time | ❌ >200ms     | ✅ <50ms             |
| CLS                 | ⚠️ 有抖动     | ✅ 近乎为 0          |
| 移动端支持          | ❌ 无点击交互 | ✅ 点击 + 滑动       |
| 图像加载效率        | ❌ 全部预加载 | ✅ 懒加载 + 优先首图 |

---

## 📦 结语

本次优化遵循“**首屏先快，互动后加载**”的策略，最大程度提升了滚动图廊组件在视觉稳定性和加载速度方面的体验。适用于所有图片展示型页面，特别是移动端用户比例较高的站点。

如需进一步拓展幻灯片、懒加载分页、模糊占位图等功能，可基于本结构继续迭代。
